<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lesson 10 homework</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
  <!--Задача №1 "Создать скрывающееся/рвскрывающееся меню"-->
  <div id="exercise_1" class="exercise">
    <div class="conditions">
      При помощи 1 обработчика сделайте (скрытие/раскрытие) пунктов списка
      при сворачивании списка, знак "плюс" должен меняться на "минус"
    </div>
    <div class="solution">
      <div id="toggle-list" class="toggle-list">
        <ul class="toggle-list_list">
          <div class="toggle-list_toggler">
            <div class="toggle-list_toggler_icon">+</div>
            <div class="toggle-list_toggler_label">Страны</div>
          </div>
          <li class="toggle-list_item">
            <ul class="toggle-list_list">
              <div class="toggle-list_toggler">
                <div class="toggle-list_toggler_icon">+</div>
                <div class="toggle-list_toggler_label">Россия</div>
              </div>
              <li class="toggle-list_item">Москва</li>
              <li class="toggle-list_item">Питер</li>
              <li class="toggle-list_item">Омск</li>
            </ul>
          </li>
          <li class="toggle-list_item">
            <ul class="toggle-list_list">
              <div class="toggle-list_toggler">
                <div class="toggle-list_toggler_icon">+</div>
                <div class="toggle-list_toggler_label">Америка</div>
              </div>
              <li class="toggle-list_item">Нью-Йорк</li>
              <li class="toggle-list_item">Лос-Анджелес</li>
              <li class="toggle-list_item">Чикаго</li>
            </ul>
          </li>
          <li class="toggle-list_item">
            <ul class="toggle-list_list">
              <div class="toggle-list_toggler">
                <div class="toggle-list_toggler_icon">+</div>
                <div class="toggle-list_toggler_label">Китай</div>
              </div>
              <li class="toggle-list_item">Шанхай</li>
              <li class="toggle-list_item">Пекин</li>
              <li class="toggle-list_item">Тяньцзинь</li>
            </ul>
          </li>
        </ul>
      </div>
      <script>
        const exercise1 = document.querySelector('#exercise_1');
       
        const list =  exercise1.querySelectorAll('.toggle-list_list');
        const toggler = exercise1.querySelectorAll('.toggle-list_toggler');
       
        toggler.forEach( item=>item.addEventListener('click', openHideItem) );
       
        function openHideItem(){
          let target = event.target; //заголовок, иконка или родительский див 
          
          if( target.classList.contains('toggle-list_toggler_label')){
            target = target.closest('.toggle-list_toggler').querySelector('.toggle-list_toggler_icon');
          }
          if (target.classList.contains('toggle-list_toggler')){
            target = target.querySelector('.toggle-list_toggler_icon');
          }

          target.innerHTML = target.innerHTML === '+' ? '-' :'+';
          const listBody = target.closest('.toggle-list_list').querySelectorAll('.toggle-list_item');
          listBody.forEach( item=>item.hidden = !item.hidden );

        }
        
      </script>
    </div>
  </div>

    <!--Задача №2 "Оживить карусель"-->
    <div id="exercise_2" class="exercise">
      <div class="conditions">
        <p>
          При клике на синюю кнопку, карусель должна прокрутиться на 1 элемент вправо (если мы не достигли конца)
        </p>
        <p>
          При клике на красную кнопку карусель должна прокрутиться на 1 элемент влево (если мы не достигли начала)
        </p>
        <p>
          <em>
            Постарайтесь написать свою разметку html, чтобы понять принцип работы карусели
          </em>
        </p>
      </div>
      <div class="solution">
        <div class="carousel">
          <div class="carousel_button carousel_button_prev"></div>
          <div class="carousel_button carousel_button_next"></div>
          <div class="carousel_list_wrapper">
            <ul class="carousel_list">
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/1.png" alt="smile-1">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/2.png" alt="smile-2">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/3.png" alt="smile-3">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/4.png" alt="smile-4">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/5.png" alt="">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/6.png" alt="">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/7.png" alt="">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/8.png" alt="">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/9.png" alt="">
              </li>
              <li class="carousel_list_item">
                <img src="https://ru.js.cx/carousel/10.png" alt="">
              </li>
            </ul>
          </div>
        </div>
        <script>
          const exercise2 = document.querySelector('#exercise_2');
          const carousel=  exercise2.querySelector('.carousel');
          const next = carousel.querySelector(".carousel_button_next");
          next.addEventListener('click', goNext);

          const prev = carousel.querySelector(".carousel_button_prev");
          prev.addEventListener('click', goPrev);

          const carouselList = carousel.querySelector(".carousel_list");
           const margin = carouselList.querySelector('.carousel_list_item img').clientWidth; //ширина картинки, допустим все одинаковые

          const carouselLengthPx = carousel.querySelectorAll('.carousel_list_item').length * margin;
          

          function goNext(){
            
            let margin_left = carouselList.style.marginLeft;
          
            if(margin_left!='0px' && margin_left!=''){ //работает
             
              margin_left = margin_left.substr(0, margin_left.length-2);
              margin_left = +margin_left + margin +'px';

              carouselList.style.marginLeft = margin_left;
            
            }
           

          }
          function goPrev(){
            let margin_left = carouselList.style.marginLeft;
         
            if( margin_left != '-910px'){
              //1300 - 3
              
              margin_left = margin_left.substr(0, margin_left.length-2);
              margin_left = +margin_left - 130 +'px';

              carouselList.style.marginLeft = margin_left;
             
            }
          }
          //почему обработчик работает на обеих кнопках


        </script>
      </div>
    </div>

  <!--Задача №3 "Поведение подсказка"-->
  <button id='btnTestLeft' data-tooltip="Lorem ipsum dolor sit amet consectetur adipisicing elit. Sint odit qui neque velit, minus quis laboriosam corporis facere quam ratione veritatis ea eos recusandae ipsa quibusdam veniam. Quia optio, magnam sunt tempora eum odio deleniti corporis laudantium unde! Minus eum sed perspiciatis ratione tenetur, quae doloribus cum nisi error. Eaque quo eligendi obcaecati maiores laborum veritatis alias, sunt sapiente dolorum iure officia? Ex, maiores nesciunt? Tempore, sed veniam, exercitationem repellat delectus repudiandae provident quis maxime magni dignissimos harum unde iste reprehenderit minima animi explicabo enim perferendis sequi esse cumque voluptas accusantium corporis maiores dicta. Dicta nam mollitia tempore veniam necessitatibus!">btn</button>
  <button id='btnTestLeft2' data-tooltip="HTML<br>подсказка Lorem ipsum dolor sit amet consectetur adipisicing elit. Sequi, vitae.">btn</button>
  <div id="exercise_3" class="exercise">
    <div class="conditions">
        При наведении мыши на элемент <em>(количество таких элементов на странице может быть любым)</em> с атрибутом data-tooltip,
        над ним должна показываться подсказка и скрываться при переходе на другой элемент.
    </div>
    <div class="solution">
      <div class="article">
        <p>
            Товарищи! сложившаяся структура организации представляет собой интересный эксперимент проверки направлений прогрессивного развития. С другой стороны рамки и место обучения кадров способствует подготовки и реализации модели развития.
        </p>
        <button data-tooltip="эта подсказка длиннее, чем элемент">Короткая кнопка</button>
        <button data-tooltip="HTML<br>подсказка">Ещё кнопка</button>
        <button data-tooltip="HTML<br>подсказка khjvglhjvglj kjblkbhj;kj ;lkj;jb;kjb;kj ">Ещё кнопка</button>
        <button data-tooltip="Lorem ipsum dolor sit amet consectetur adipisicing elit. Sint odit qui neque velit, minus quis laboriosam corporis facere quam ratione veritatis ea eos recusandae ipsa quibusdam veniam. Quia optio, magnam sunt tempora eum odio deleniti corporis laudantium unde! Minus eum sed perspiciatis ratione tenetur, quae doloribus cum nisi error. Eaque quo eligendi obcaecati maiores laborum veritatis alias, sunt sapiente dolorum iure officia? Ex, maiores nesciunt? Tempore, sed veniam, exercitationem repellat delectus repudiandae provident quis maxime magni dignissimos harum unde iste reprehenderit minima animi explicabo enim perferendis sequi esse cumque voluptas accusantium corporis maiores dicta. Dicta nam mollitia tempore veniam necessitatibus!">Ещё кнопка</button>
       
        
      </div>
     
      <script>
        const exercise3 = document.querySelector('#exercise_3');
        
        const elemsWithTooltips = document.querySelectorAll('[data-tooltip]');
        let tooltip = document.createElement('div');
        elemsWithTooltips.forEach(function(elem){
        elem.addEventListener('mouseenter', function(event){
            
         
          tooltip.innerHTML = event.target.dataset.tooltip;
          //console.log(tooltip.innerHTML);
          let rect = elem.getBoundingClientRect();
          console.log('rect.left '+rect.left+', rect.top '+rect.top)
          tooltip.style.position ='absolute';


          tooltip.style.left = rect.left + window.pageXOffset +'px';
        
          tooltip.style.background = 'lightblue';
          tooltip.style.border='1px solid gray';

          document.body.appendChild(tooltip);
          //если большая подсказка сильно сжалась по ширине
          //(хотя бы в 2 раза высота больше - уже тяжело читать)
          //немного ее расширяем
          if(tooltip.clientHeight>2*tooltip.clientWidth){ 
            tooltip.style.left = rect.left + window.pageXOffset - 2*tooltip.clientWidth +'px';
            
          }
          if(rect.top<tooltip.clientHeight){ //показать подсказку внизу, если кнопка сверху
            tooltip.style.top = window.pageYOffset+rect.bottom +3 +'px';
            
          }else{
            tooltip.style.top = rect.top + window.pageYOffset-tooltip.clientHeight - 3 +'px';
          }
         
        });
        elem.addEventListener('mouseleave', function(event){
            document.body.removeChild(tooltip);
        });
      });
        
      </script>
    </div>
</div>

<!--Задача №4 Самостоятельно: "Отмена действия по умолчанию"-->
  <div id="exercise_4" class="exercise">
    <div class="conditions">
      Решить при помощи делегирования
      Можно добавить в html любые атрибуты
    </div>
    <div class="solution">
      <div class="menu_highlight">
        <ul class="menu_highlight_list">
            <li class="menu_highlight_item">
              <a href="https://yandex.ru"  class='right-click'>
                  Переход на yandex только при клике правой кнопкой мыши
              </a>
            </li>
            <li class="menu_highlight_item">
              <a href="https://google.ru"  class='double-click' >
                <strong>
                  Переход на google только при двойном клике
                </strong>
              </a>
            </li>
            <li class="menu_highlight_item">
              <a href="https://mail.ru"  class='shift-click'>
                <em>
                  Переход на mail только при клике с нажатой кнопкой 'Shift'
                </em>
              </a>
            </li>
        </ul>
      </div>
      <script>
        const exercise4 = document.querySelector('#exercise_4');
        
        const menuItemsLinks = exercise4.querySelectorAll('.menu_highlight_item a');
        menuItemsLinks.forEach(function(item){
            item.addEventListener('click', function(event){
              event.preventDefault();
            });
        });
       const yandex = exercise4.querySelector('.menu_highlight_item .right-click');
        
        yandex.addEventListener('contextmenu', function(){
         
              let target = event.target; 
              if(target.tagName !== 'A'){
                target = target.closest('a');
              } 
              if(target.tagName === 'A'){ 
                event.preventDefault(); //чтобы контекстное меню не вылезало
                const href = target.getAttribute('href');
                goLink(href);
              }

        });
        const google = exercise4.querySelector('.menu_highlight .double-click');
        
        google.addEventListener('click', function(event){
             

              let target = event.target; 
              if(target.classList.contains('clicked')){ //класс для проверки нажатия

                target.classList.toggle('clicked');
                if(target.tagName !== 'A'){
                  target = target.closest('a');
                } 
                if(target.tagName === 'A'){ 
                  const href = target.getAttribute('href');
                  goLink(href);
                }
              } else {
                target.classList.toggle('clicked');
                 
                setTimeout(function(){ //убираем класс - двойной клик только за небольшой промежуток должен работать
                  target.classList.toggle('clicked');
                }, 1000);
              }
              
             

        });
        
        const mail = exercise4.querySelector('.menu_highlight .shift-click');
 
        mail.addEventListener('click', function(event){
              
  
              let target = event.target; 
              if(target.tagName !== 'A'){
                target = target.closest('a');
              } 
              if(target.tagName === 'A'){ 
                if(event.shiftKey){
                  const href = target.getAttribute('href');
                  goLink(href);
                }
                
              }

        });

        function goLink(href){
                  document.location.href = href;
        }
        

      </script>
    </div>
  </div>
</body>
</html>
